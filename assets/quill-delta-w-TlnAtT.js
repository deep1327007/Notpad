import{g as S}from"./any-base-B1025x16.js";import{r as U}from"./fast-diff-BGhgD5-Y.js";import{r as R}from"./lodash.clonedeep-0VCzKUaf.js";import{r as $}from"./lodash.isequal-DXWrDRUm.js";var E={exports:{}},T={},q;function _(){if(q)return T;q=1,Object.defineProperty(T,"__esModule",{value:!0});const k=R(),j=$();var w;return function(o){function y(d={},h={},f=!1){typeof d!="object"&&(d={}),typeof h!="object"&&(h={});let c=k(h);f||(c=Object.keys(c).reduce((e,t)=>(c[t]!=null&&(e[t]=c[t]),e),{}));for(const e in d)d[e]!==void 0&&h[e]===void 0&&(c[e]=d[e]);return Object.keys(c).length>0?c:void 0}o.compose=y;function g(d={},h={}){typeof d!="object"&&(d={}),typeof h!="object"&&(h={});const f=Object.keys(d).concat(Object.keys(h)).reduce((c,e)=>(j(d[e],h[e])||(c[e]=h[e]===void 0?null:h[e]),c),{});return Object.keys(f).length>0?f:void 0}o.diff=g;function m(d={},h={}){d=d||{};const f=Object.keys(h).reduce((c,e)=>(h[e]!==d[e]&&d[e]!==void 0&&(c[e]=h[e]),c),{});return Object.keys(d).reduce((c,e)=>(d[e]!==h[e]&&h[e]===void 0&&(c[e]=null),c),f)}o.invert=m;function b(d,h,f=!1){if(typeof d!="object")return h;if(typeof h!="object")return;if(!f)return h;const c=Object.keys(h).reduce((e,t)=>(d[t]===void 0&&(e[t]=h[t]),e),{});return Object.keys(c).length>0?c:void 0}o.transform=b}(w||(w={})),T.default=w,T}var I={},A;function P(){if(A)return I;A=1,Object.defineProperty(I,"__esModule",{value:!0});var k;return function(j){function w(o){return typeof o.delete=="number"?o.delete:typeof o.retain=="number"?o.retain:typeof o.retain=="object"&&o.retain!==null?1:typeof o.insert=="string"?o.insert.length:1}j.length=w}(k||(k={})),I.default=k,I}var M={},N;function F(){if(N)return M;N=1,Object.defineProperty(M,"__esModule",{value:!0});const k=P();class j{constructor(o){this.ops=o,this.index=0,this.offset=0}hasNext(){return this.peekLength()<1/0}next(o){o||(o=1/0);const y=this.ops[this.index];if(y){const g=this.offset,m=k.default.length(y);if(o>=m-g?(o=m-g,this.index+=1,this.offset=0):this.offset+=o,typeof y.delete=="number")return{delete:o};{const b={};return y.attributes&&(b.attributes=y.attributes),typeof y.retain=="number"?b.retain=o:typeof y.retain=="object"&&y.retain!==null?b.retain=y.retain:typeof y.insert=="string"?b.insert=y.insert.substr(g,o):b.insert=y.insert,b}}else return{retain:1/0}}peek(){return this.ops[this.index]}peekLength(){return this.ops[this.index]?k.default.length(this.ops[this.index])-this.offset:1/0}peekType(){const o=this.ops[this.index];return o?typeof o.delete=="number"?"delete":typeof o.retain=="number"||typeof o.retain=="object"&&o.retain!==null?"retain":"insert":"retain"}rest(){if(this.hasNext()){if(this.offset===0)return this.ops.slice(this.index);{const o=this.offset,y=this.index,g=this.next(),m=this.ops.slice(this.index);return this.offset=o,this.index=y,[g].concat(m)}}else return[]}}return M.default=j,M}var D;function Q(){return D||(D=1,function(k,j){Object.defineProperty(j,"__esModule",{value:!0}),j.AttributeMap=j.OpIterator=j.Op=void 0;const w=U(),o=R(),y=$(),g=_();j.AttributeMap=g.default;const m=P();j.Op=m.default;const b=F();j.OpIterator=b.default;const d="\0",h=(c,e)=>{if(typeof c!="object"||c===null)throw new Error(`cannot retain a ${typeof c}`);if(typeof e!="object"||e===null)throw new Error(`cannot retain a ${typeof e}`);const t=Object.keys(c)[0];if(!t||t!==Object.keys(e)[0])throw new Error(`embed types not matched: ${t} != ${Object.keys(e)[0]}`);return[t,c[t],e[t]]};class f{constructor(e){Array.isArray(e)?this.ops=e:e!=null&&Array.isArray(e.ops)?this.ops=e.ops:this.ops=[]}static registerEmbed(e,t){this.handlers[e]=t}static unregisterEmbed(e){delete this.handlers[e]}static getHandler(e){const t=this.handlers[e];if(!t)throw new Error(`no handlers for embed type "${e}"`);return t}insert(e,t){const n={};return typeof e=="string"&&e.length===0?this:(n.insert=e,t!=null&&typeof t=="object"&&Object.keys(t).length>0&&(n.attributes=t),this.push(n))}delete(e){return e<=0?this:this.push({delete:e})}retain(e,t){if(typeof e=="number"&&e<=0)return this;const n={retain:e};return t!=null&&typeof t=="object"&&Object.keys(t).length>0&&(n.attributes=t),this.push(n)}push(e){let t=this.ops.length,n=this.ops[t-1];if(e=o(e),typeof n=="object"){if(typeof e.delete=="number"&&typeof n.delete=="number")return this.ops[t-1]={delete:n.delete+e.delete},this;if(typeof n.delete=="number"&&e.insert!=null&&(t-=1,n=this.ops[t-1],typeof n!="object"))return this.ops.unshift(e),this;if(y(e.attributes,n.attributes)){if(typeof e.insert=="string"&&typeof n.insert=="string")return this.ops[t-1]={insert:n.insert+e.insert},typeof e.attributes=="object"&&(this.ops[t-1].attributes=e.attributes),this;if(typeof e.retain=="number"&&typeof n.retain=="number")return this.ops[t-1]={retain:n.retain+e.retain},typeof e.attributes=="object"&&(this.ops[t-1].attributes=e.attributes),this}}return t===this.ops.length?this.ops.push(e):this.ops.splice(t,0,e),this}chop(){const e=this.ops[this.ops.length-1];return e&&typeof e.retain=="number"&&!e.attributes&&this.ops.pop(),this}filter(e){return this.ops.filter(e)}forEach(e){this.ops.forEach(e)}map(e){return this.ops.map(e)}partition(e){const t=[],n=[];return this.forEach(r=>{(e(r)?t:n).push(r)}),[t,n]}reduce(e,t){return this.ops.reduce(e,t)}changeLength(){return this.reduce((e,t)=>t.insert?e+m.default.length(t):t.delete?e-t.delete:e,0)}length(){return this.reduce((e,t)=>e+m.default.length(t),0)}slice(e=0,t=1/0){const n=[],r=new b.default(this.ops);let s=0;for(;s<t&&r.hasNext();){let i;s<e?i=r.next(e-s):(i=r.next(t-s),n.push(i)),s+=m.default.length(i)}return new f(n)}compose(e){const t=new b.default(this.ops),n=new b.default(e.ops),r=[],s=n.peek();if(s!=null&&typeof s.retain=="number"&&s.attributes==null){let a=s.retain;for(;t.peekType()==="insert"&&t.peekLength()<=a;)a-=t.peekLength(),r.push(t.next());s.retain-a>0&&n.next(s.retain-a)}const i=new f(r);for(;t.hasNext()||n.hasNext();)if(n.peekType()==="insert")i.push(n.next());else if(t.peekType()==="delete")i.push(t.next());else{const a=Math.min(t.peekLength(),n.peekLength()),l=t.next(a),p=n.next(a);if(p.retain){const u={};if(typeof l.retain=="number")u.retain=typeof p.retain=="number"?a:p.retain;else if(typeof p.retain=="number")l.retain==null?u.insert=l.insert:u.retain=l.retain;else{const O=l.retain==null?"insert":"retain",[L,v,C]=h(l[O],p.retain),H=f.getHandler(L);u[O]={[L]:H.compose(v,C,O==="retain")}}const x=g.default.compose(l.attributes,p.attributes,typeof l.retain=="number");if(x&&(u.attributes=x),i.push(u),!n.hasNext()&&y(i.ops[i.ops.length-1],u)){const O=new f(t.rest());return i.concat(O).chop()}}else typeof p.delete=="number"&&(typeof l.retain=="number"||typeof l.retain=="object"&&l.retain!==null)&&i.push(p)}return i.chop()}concat(e){const t=new f(this.ops.slice());return e.ops.length>0&&(t.push(e.ops[0]),t.ops=t.ops.concat(e.ops.slice(1))),t}diff(e,t){if(this.ops===e.ops)return new f;const n=[this,e].map(l=>l.map(p=>{if(p.insert!=null)return typeof p.insert=="string"?p.insert:d;const u=l===e?"on":"with";throw new Error("diff() called "+u+" non-document")}).join("")),r=new f,s=w(n[0],n[1],t,!0),i=new b.default(this.ops),a=new b.default(e.ops);return s.forEach(l=>{let p=l[1].length;for(;p>0;){let u=0;switch(l[0]){case w.INSERT:u=Math.min(a.peekLength(),p),r.push(a.next(u));break;case w.DELETE:u=Math.min(p,i.peekLength()),i.next(u),r.delete(u);break;case w.EQUAL:u=Math.min(i.peekLength(),a.peekLength(),p);const x=i.next(u),O=a.next(u);y(x.insert,O.insert)?r.retain(u,g.default.diff(x.attributes,O.attributes)):r.push(O).delete(u);break}p-=u}}),r.chop()}eachLine(e,t=`
`){const n=new b.default(this.ops);let r=new f,s=0;for(;n.hasNext();){if(n.peekType()!=="insert")return;const i=n.peek(),a=m.default.length(i)-n.peekLength(),l=typeof i.insert=="string"?i.insert.indexOf(t,a)-a:-1;if(l<0)r.push(n.next());else if(l>0)r.push(n.next(l));else{if(e(r,n.next(1).attributes||{},s)===!1)return;s+=1,r=new f}}r.length()>0&&e(r,{},s)}invert(e){const t=new f;return this.reduce((n,r)=>{if(r.insert)t.delete(m.default.length(r));else{if(typeof r.retain=="number"&&r.attributes==null)return t.retain(r.retain),n+r.retain;if(r.delete||typeof r.retain=="number"){const s=r.delete||r.retain;return e.slice(n,n+s).forEach(a=>{r.delete?t.push(a):r.retain&&r.attributes&&t.retain(m.default.length(a),g.default.invert(r.attributes,a.attributes))}),n+s}else if(typeof r.retain=="object"&&r.retain!==null){const s=e.slice(n,n+1),i=new b.default(s.ops).next(),[a,l,p]=h(r.retain,i.insert),u=f.getHandler(a);return t.retain({[a]:u.invert(l,p)},g.default.invert(r.attributes,i.attributes)),n+1}}return n},0),t.chop()}transform(e,t=!1){if(t=!!t,typeof e=="number")return this.transformPosition(e,t);const n=e,r=new b.default(this.ops),s=new b.default(n.ops),i=new f;for(;r.hasNext()||s.hasNext();)if(r.peekType()==="insert"&&(t||s.peekType()!=="insert"))i.retain(m.default.length(r.next()));else if(s.peekType()==="insert")i.push(s.next());else{const a=Math.min(r.peekLength(),s.peekLength()),l=r.next(a),p=s.next(a);if(l.delete)continue;if(p.delete)i.push(p);else{const u=l.retain,x=p.retain;let O=typeof x=="object"&&x!==null?x:a;if(typeof u=="object"&&u!==null&&typeof x=="object"&&x!==null){const L=Object.keys(u)[0];if(L===Object.keys(x)[0]){const v=f.getHandler(L);v&&(O={[L]:v.transform(u[L],x[L],t)})}}i.retain(O,g.default.transform(l.attributes,p.attributes,t))}}return i.chop()}transformPosition(e,t=!1){t=!!t;const n=new b.default(this.ops);let r=0;for(;n.hasNext()&&r<=e;){const s=n.peekLength(),i=n.peekType();if(n.next(),i==="delete"){e-=Math.min(s,e-r);continue}else i==="insert"&&(r<e||!t)&&(e+=s);r+=s}return e}}f.Op=m.default,f.OpIterator=b.default,f.AttributeMap=g.default,f.handlers={},j.default=f,k.exports=f,k.exports.default=f}(E,E.exports)),E.exports}var z=Q();const V=S(z);export{V as D,z as a};
